<div class="checkout-create">
    <h3>Update {{item.checkout_title}} Checkout Form</h3>
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active">
            <a href="#required" aria-controls="details" role="tab" data-toggle="tab">Required</a>
        </li>
        <li role="presentation"{{#if errors.item}} class="error"{{/if}}>
            <a href="#items" aria-controls="items" role="tab" data-toggle="tab">Items</a>
        </li>
        <li role="presentation">
            <a href="#customer" aria-controls="customer-info" role="tab" data-toggle="tab">Customer</a>
        </li>
        <li role="presentation"{{#if errors.address}} class="error"{{/if}}>
            <a href="#addresses" aria-controls="addres" role="tab" data-toggle="tab">Addresses</a>
        </li>
        <li role="presentation">
            <a href="#advanced" aria-controls="advanced" role="tab" data-toggle="tab">Advanced</a>
        </li>
    </ul>
    
    <!-- Checkout Create Form -->
    <form method="post">
        <!-- Tab panes -->
        <div class="tab-content">
            <!-- Checkout Details Tab -->
            <div role="tabpanel" class="tab-pane fade in active" id="required">
                <div class="form-group{{#if errors.checkout_title}} has-error{{/if}}">
                    <label class="control-label">Title of Checkout Form</label>
                    <div>
                        <input type="text" name="checkout_title" class="form-control" value="{{item.checkout_title}}" />
                        {{#if errors.checkout_title}}
                        <span class="help-text">{{errors.checkout_title}}</span>
                        {{/if}}
                    </div>
                </div>
                <div class="form-group{{#if errors.checkout_redirect}} has-error{{/if}}">
                    <label class="control-label">URL Redirect</label>
                    <div>
                        <input type="url" name="checkout_redirect" class="form-control" value="{{item.checkout_redirect}}" />
                        {{#if errors.checkout_redirect}}
                        <span class="help-text">{{errors.checkout_redirect}}</span>
                        {{/if}}
                    </div>
                </div>
                
                <div class="form-group{{#if errors.checkout_shipping}} has-error{{/if}}">
                    <div class="checkbox">
                        <label>
                            <input 
                                type="checkbox" 
                                name="checkout_shipping" 
                                value="1" 
                                {{~#if item.checkout_shipping}}
                                checked="checked"
                                {{~/if}} />
                            <span>Add Shipping Fields</span>
                        </label>
                    </div>
                </div>
                <!-- Payment Gateway -->
                <div class="panel panel-default clear">
                    <div class="panel-heading brand">
                        <h3 class="panel-title">Payment Gateways {{#if errors.checkout_gateways}}
                        <span class="text-danger"> - {{errors.checkout_gateways}}</span>
                        {{/if}}</h3>
                    </div>
                    <div class="panel-body">
                        {{#each checkout_gateways}}
                        <div class="checkbox">
                            <label>
                                <input 
                                    type="checkbox" 
                                    name="checkout_gateways[]" 
                                    value="{{name}}" 
                                    {{~#if checked}}
                                    checked="checked"
                                    {{~/if}} />
                                <span>{{title}}</span>
                            </label>
                        </div>
                        {{/each}}
                    </div>
                </div>
            </div>
            
            <div role="tabpanel" class="tab-pane fade add-item" id="items">
            	{{#each item.item}}
                <div class="form-group">
                    <label>Name</label>
                    <label>Amount (PHP)</label>
                    <label>Image</label>
                    <label>Link</label>
                    <div>
                        <input 
                            type="text" 
                            name="item[{{@index}}][item_name]" 
                            placeholder="Product Name" 
                            value="{{item_name}}" />
                            
                        <input 
                            type="text" 
                            name="item[{{@index}}][item_price]" 
                            min="0" 
                            step="0.01" 
                            placeholder="99.00" 
                            value="{{item_price}}" />
                        
                        <input 
                            type="url" 
                            name="item[{{@index}}][item_image]" 
                            placeholder="http://example.com/sample.jpg" 
                            value="{{item_image}}" />
                        
                        <input 
                            type="url" 
                            name="item[{{@index}}][item_link]" 
                            placeholder="http://example.com/product/detail/123" 
                            value="{{item_link}}" />
                    </div>
                    <span class="help-text text-danger">{{errors.item_name}}</span>
                    <span class="help-text text-danger">{{errors.item_price}}</span>
                    <span class="help-text text-danger">{{errors.item_image}}</span>
                    <span class="help-text text-danger">{{errors.item_link}}</span>
                </div>
                {{/each}}
                <button class="btn btn-success">Add Item</button>
            </div>
            
            <!-- Cunstomer Information Tab -->
            <div role="tabpanel" class="tab-pane fade " id="customer">
            	<div class="form-group{{#if errors.profile_name}} has-error{{/if}}">
                    <label class="control-label">Full Name</label>
                    <div>
                        <input type="text" name="profile_name" class="form-control" value="{{item.profile_name}}" />
                        {{#if errors.profile_name}}
                        <span class="help-text">{{errors.profile_name}}</span>
                        {{/if}}
                    </div>
                </div>
                <div class="form-group{{#if errors.profile_email}} has-error{{/if}}">
                    <label class="control-label">Email</label>
                    <div>
                        <input type="email" name="profile_email" class="form-control" value="{{item.profile_email}}" />
                        {{#if errors.profile_email}}
                        <span class="help-text">{{errors.profile_email}}</span>
                        {{/if}}
                    </div>
                </div>
                <div class="form-group{{#if errors.profile_phone}} has-error{{/if}}">
                    <label class="control-label">Phone #</label>
                    <div>
                        <input type="tel" name="profile_phone" class="form-control" value="{{item.profile_phone}}" />
                        {{#if errors.profile_phone}}
                        <span class="help-text">{{errors.profile_phone}}</span>
                        {{/if}}
                    </div>
                </div>
            </div>
            
            <div role="tabpanel" class="tab-pane fade add-address" id="addresses">
            	{{#each item.address}}
                <div class="form-group">
                    <label>Label</label>
                    <label>Street</label>
                    <label>City</label>
                    <label>State</label>
                    <label>Country</label>
                    <label>Postal</label>
                    <div>
                        <input 
                            type="text" 
                            name="address[{{@index}}][address_label]" 
                            placeholder="My Home" 
                            value="{{address_label}}" />
                        
                        <input 
                            type="text" 
                            name="address[{{@index}}][address_street]" 
                            placeholder="123 Sesame Street" 
                            value="{{address_street}}" />
                        
                        <input 
                            type="text" 
                            name="address[{{@index}}][address_city]" 
                            placeholder="Mandaluyong City" 
                            value="{{address_city}}" />
                        
                        <input 
                            type="text" 
                            name="address[{{@index}}][address_state]" 
                            placeholder="Metro Manila" 
                            value="{{address_state}}" />
                        
                        <select 
                        	data-value="{{address_country}}" 
                            name="address[{{@index}}][address_country]" 
                            class="form-control">
                            <option value="">Choose a Country</option>
                            {{#each ../countries}}
                            <option value="{{code}}">{{name}}</option>
                            {{/each}}
                        </select>
                        
                        <input 
                            type="text" 
                            name="address[{{@index}}][address_postal]" 
                            placeholder="1551" 
                            value="{{address_postal}}" />
                    </div>
                    
                    <span class="help-text text-danger">{{errors.address_label}}</span>
                    <span class="help-text text-danger">{{errors.address_street}}</span>
                    <span class="help-text text-danger">{{errors.address_city}}</span>
                    <span class="help-text text-danger">{{errors.address_state}}</span>
                    <span class="help-text text-danger">{{errors.address_country}}</span>
                    <span class="help-text text-danger">{{errors.address_postal}}</span>
                </div>
                {{/each}}
                <button class="btn btn-success">Add Address</button>
            </div>
            
            <!-- Advance Option Tab -->
            <div role="tabpanel" class="tab-pane fade" id="advanced">
                <div class="form-group{{#if errors.checkout_style}} has-error{{/if}}">
                    <label class="control-label">URL Styles</label>
                    <div>
                        <input type="url" name="checkout_style" class="form-control" value="{{item.checkout_style}}" />
                        {{#if errors.checkout_style}}
                        <span class="help-text">{{errors.checkout_style}}</span>
                        {{/if}}
                    </div>
                </div>
                <div class="form-group{{#if errors.checkout_terms}} has-error{{/if}}">
                    <label class="control-label">URL Terms and Conditions</label>
                    <div>
                        <input type="url" name="checkout_terms" class="form-control" value="{{item.checkout_terms}}" />
                        {{#if errors.checkout_terms}}
                        <span class="help-text">{{errors.checkout_terms}}</span>
                        {{/if}}
                    </div>
                </div>
            </div>
        </div>
                
        <!-- Submit Button -->
         <div class="clear form-group">
           <button type="submit" class="btn btn-primary">Submit</button>
        </div>
    </form>
</div>

<script id="template-item" type="text/html">
    <div class="form-group">
        <label>Name</label>
        <label>Amount (PHP)</label>
        <label>Image</label>
        <label>Link</label>
        <div>
            <input type="text" name="item[{INDEX}][item_name]" placeholder="Product Name" />
            <input type="number" name="item[{INDEX}][item_price]" min="0" step="0.01" placeholder="99.00" />
            <input type="url" name="item[{INDEX}][item_image]" placeholder="http://example.com/sample.jpg" />
            <input type="url" name="item[{INDEX}][item_link]" placeholder="http://example.com/product/detail/123" />
        </div>
    </div>
</script>
<script id="template-address" type="text/html">
    <div class="form-group">
        <label>Label</label>
        <label>Street</label>
        <label>City</label>
        <label>State</label>
        <label>Country</label>
        <label>Postal</label>
        <div>
            <input type="text" name="address[{INDEX}][address_label]" placeholder="My Home" />
            <input type="text" name="address[{INDEX}][address_street]" placeholder="123 Sesame Street" />
            <input type="text" name="address[{INDEX}][address_city]" placeholder="Mandaluyong City" />
            <input type="text" name="address[{INDEX}][address_state]" placeholder="Metro Manila" />
            <select name="address[{INDEX}][address_country]">
				<option value="">Choose a Country</option>
				{{#each countries}}
				<option value="{{code}}">{{name}}</option>
				{{/each}}
			</select>
            <input type="text" name="address[{INDEX}][address_postal]" placeholder="1551" />
        </div>
    </div>
</script>
<script type="text/javascript">
(function() {
    var i = $('div.add-item div.form-group').length, 
        j = $('div.add-address div.form-group').length;
    
    $('div.add-item button').click(function(e) {
        var template = $('#template-item').html();
        var html = template.replace(/\{INDEX\}/ig, i++);
        $('div.add-item button').before(html);
        
        return false;
    });
	
	if(i === 0) {
		$('div.add-item button').trigger('click');
	}
    
	$('div.add-address select').each(function() {
		var value = $(this).attr('data-value');
		
		if(!value) {
			return;
		}
		
		$('option[value="'+value+'"]', this).attr('selected', true);
	});
	
    $('div.add-address button').click(function(e) {
        var template = $('#template-address').html();
        var html = template.replace(/\{INDEX\}/ig, j++);
        $('div.add-address button').before(html);
        
        return false;
    });
	
	if(j === 0) {
		$('div.add-address button').trigger('click');
	}
})();
</script>